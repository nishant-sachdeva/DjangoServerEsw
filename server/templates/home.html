{% extends 'base.html' %} {% block content %}

<script>

function turnon() {
  fetch("https://nishantsachdeva.pythonanywhere.com/turn_on")
    .then(response => response.json())
    .catch(error => {
      console.log(error)
    })
}

function turnoff() {
  fetch("https://nishantsachdeva.pythonanywhere.com/turn_off")
    .then(response => response.json())
    .catch(error => {
      console.log(error)
    })
}

function auto() {
  fetch("https://nishantsachdeva.pythonanywhere.com/turn_to_auto")
}

</script>


<script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.5.0/Chart.min.js"></script>
<div class="container h-50 w-100">
  <div class="row h-100">
    <div class="col-12 col-md-8 w-100">
			<div class="chartjs-wrapper">
				<canvas id="chartjs-0" class="chartjs" width="125" height="100">
				</canvas>
			</div>
    </div>
    {% if list.status == 1 %}
    <div class="col-12 col-md-4 bg-dark text-white">
      {% else %}
      <div class="col-12 col-md-4 bg-light text-dark">
        {% endif %}
        <div class="container d-flex h-100 align-items-center">
          <div class="col text-center">
            <h1>
              {% if list.status == 1 %} The light is<br/> <b>ON</b> {% else %} The light is
              <br/><b>OFF</b> {% endif %}

            </h1>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<div class="py-5"></div>

<div class="progress my-5">
  <div class="progress-bar bg-info" role="progressbar" style="width: 100%" aria-valuenow="50" aria-valuemin="0" aria-valuemax="100">
  </div>
</div>

<div class="container-fluid py-5 bg-dark text-white px-5">
  <div class="row">
    <div class="col">
      <div class="container">
        <div class="row">
          <div class="col text-center">
              <h1>Current Mode of Operation: <b> {% if list.mode == 1 %} Automatic {% else %} Manual {% endif %}</b> </h1>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>


<div class="progress my-5">
    <div class="progress-bar bg-info" role="progressbar" style="width: 100%" aria-valuenow="50" aria-valuemin="0" aria-valuemax="100">
    </div>
</div>

<div class="container py-3">
  <div class="row">
    <div class="col text-center py-4">
      <h1>Want to Do Some Custom Analysis?</h1>
      <p>Download all the readings from the sensor below and infer away!</p>
    </div>
  </div>
  <div class="row">
    <div class="col text-center">
      <a href="download/" class="btn btn-dark" target="_blank"> <h1>Download Readings</h1></a>
    </div>
  </div>
</div>


<div class="progress  my-5">
  <div class="progress-bar bg-info" role="progressbar" style="width: 100%" aria-valuenow="50" aria-valuemin="0" aria-valuemax="100">
  </div>
</div>

<div class="container mt-5">
    <div class="row">
      <div class="col">
        <h2><b>Latest Reading Report:</b></h2>
      </div>
    </div>
    <div class="row pt-5">
      <div class="col">
        <h4 class="d-inline pr-3"><b>Sensor Reading:</b></h4>
        {{ list.value }}
      </div>
    </div>
    <div class="row">
      <div class="col">
        <h4 class="d-inline pr-3"><b>ID:</b></h4>
        {{ list.id }}
      </div>
    </div>
    <div class="row">
      <div class="col">
        <h4 class="d-inline pr-3"><b>Time:</b></h4>
        {{ list.time }} (UTC)
      </div>
    </div>
</div>

<div class="container my-5 bg-secondary">
    <div class="row p-5">
      <div class="col text-white">
        <h2>
          <b>The light has been on for a total time of
            {{ list.total_time }} hours
          </b>
        </h2>
      </div>
    </div>
</div>

<div class="progress  my-5">
  <div class="progress-bar bg-info" role="progressbar" style="width: 100%" aria-valuenow="50" aria-valuemin="0" aria-valuemax="100"></div>
</div>

<div class="container my-5">
    <div class="row">
        <div class="col">
            <h2><b>Cost Comparison:</b></h2>
            <p>
                The current savings leans towards the automated streetlight control approach.
            </p>
        </div>
    </div>
    <div class="row h-100">
        <div class="col" id="bar">
			<div class="chartjs-wrapper">
				<canvas id="chartjs-1" class="chartjs" width="150" height="50">
				</canvas>
			</div>
        </div>
    </div>
</div>

<div class="progress  my-5">
    <div class="progress-bar bg-info" role="progressbar" style="width: 100%" aria-valuenow="50" aria-valuemin="0" aria-valuemax="100"></div>
</div>

<div class="container h-25 my-5">
    <div class="row">
        <div class="col">
            <h2><b>Average ON Time:</b></h2>
            <p>
                This is the approximate time at which the light switches on
            </p>
        </div>
    </div>
    <div class="row pt-5">
      <div class="col text-center text-info">
        <h1>{{ list.switch_on }}</h1>
      </div>
    </div>
</div>

<div class="progress  my-5">
    <div class="progress-bar bg-info" role="progressbar" style="width: 100%" aria-valuenow="50" aria-valuemin="0" aria-valuemax="100"></div>
</div>

<div class="container h-25 my-5">
    <div class="row">
        <div class="col">
            <h2><b>Average OFF Time:</b></h2>
            <p>
                This is the approximate time at which the light switches off
            </p>
        </div>
    </div>
    <div class="row pt-5">
      <div class="col text-center text-info">
        <h1>{{ list.switch_off }}</h1>
      </div>
    </div>
</div>

<div class="progress  my-5">
    <div class="progress-bar bg-info" role="progressbar" style="width: 100%" aria-valuenow="50" aria-valuemin="0" aria-valuemax="100"></div>
</div>

<div class="container">
  <div class="row">
    <div class="col">
      <button class="btn btn-light" onclick="turnon()">
        TURN ON
      </button>
      <button class="btn btn-light" onclick="turnoff()">
        TURN OFF
      </button>
      <button class="btn btn-light" onclick="auto()">
        AUTO SWITCH
      </button>
    </div>
  </div>
</div>

<script>

  labels = [...Array(50).keys()]
  data = {{ list.set_of_values }}

  function myFunc() {
	new Chart(document.getElementById("chartjs-0"),{
		"type":"line",
		"data":{"labels": labels,
				"datasets":[{"label":"Daylight Reading Levels",
				"data": data,
				"fill":false,
				"borderColor":"rgb(75, 192, 192)",
				"lineTension":0.1}]},
		"options":{}
	});
  }

</script>

<script>

    bar_data =   [{{ list.our_cost }} , {{ list.normal_cost }}];
    console.log(bar_data);

  function Bar() {
	new Chart(document.getElementById("chartjs-1"),{
		"type":"horizontalBar",
		"data":{
		    "labels" : ["Our Cost", "Standard Cost"],
		    "datasets":[
    		        {"label":"Daylight Cost Level",
        				"data": bar_data,
        				"backgroundColor": "rgb(75, 192, 192)",
    				}
				]

		},
        "options": {
            "scales": {
                "xAxes": [{
                    "stacked": true
                }],
                "yAxes": [{
                    "stacked": true
                }]
            }
        }
	});
  }
</script>

<script>
    window.onload = () => {
        myFunc();
        Bar();
    }
</script>

{%endblock%}
